name: "test"
on:
  - push
  - pull_request

env:
  S3_ENDPOINT: 0.0.0.0:9000
  AWS_ACCESS_KEY_ID: accessKey
  AWS_SECRET_ACCESS_KEY: secretKey

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-node@v1
        with:
          node-version: 12.x
      - run: npm ci
      - run: sleep 10 # see https://github.com/yoyota-pose-estimation/upload-to-minio/issues/4
      - run: npm run test
    services:
      minio:
        # official minio/minio image entrypoint needs argument server /data
        image: bitnami/minio:2020-debian-10
        env:
          MINIO_ACCESS_KEY: accessKey
          MINIO_SECRET_KEY: secretKey
        ports:
          - 9000:9000
